<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="navbar :: head (title='#{homepage}')">

</head>
<body onload="initPage()">
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

<script type="text/javascript">
    function initPage(){
        var steps =  /*[[${allSteps}]]*/ {};
        if(steps.isEmptyObject()) {
            $('.list').hide();
        }
        else
            $('.notfound').hide();

    }
</script>
<script th:inline="javascript">
    $(document).ready(function(){
        $('.js-example-basic-single').select2();
        $('#sel').on('change', function() {
            var devices =  /*[[${allDevices}]]*/ {};
            console.log(this.value);
            $('#deviceNames')
                .empty()
                .append(' <option value="none" selected disabled hidden> Device Name </option>')
            ;
            var id = this.value;
            var count = 0;
            $.each( devices, function(key,device ) {

                if(id == device.deviceType.id){
                    count++;
                    optionText = device.devicename;
                    optionValue =  device.id;
                    $('#deviceNames').append($('<option>').val(optionValue).text(optionText));
                }});
                if (count == 0)
                    $('#deviceNames')
                        .empty()
                        .append(' <option value="none" selected disabled hidden> No Device </option>');



            document.getElementById("deviceNames").style.visibility="visible";



        });
        // Search on name column only
        $('#txt_name').keyup(function(){
            // Search Text
            var search = $(this).val();
            // Hide all table tbody rows
            $('table tbody tr').hide();

            // Count total search result
            var len = $('table tbody tr:not(.notfound) td:nth-child(1):contains("'+search+'")').length;

            if(len > 0){
                // Searching text in columns and show match row
                $('table tbody tr:not(.notfound) td:nth-child(1):contains("'+search+'")').each(function(){
                    $(this).closest('tr').show();
                });
            }else{
                $('.notfound').show();
            }

        });

    });

    // Case-insensitive searching (Note - remove the below script for Case sensitive search )
    $.expr[":"].contains = $.expr.createPseudo(function(arg) {
        return function( elem ) {
            return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
        };
    });

    function onDeviceTypeSelected(id) {
        alert(id);
        document.getElementById("DeviceNameDropDown").style.visibility="visible";


    }
</script>
<div th:replace="navbar :: navbar"></div>

<h1>Planning Tool
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary float-right" style="" data-toggle="modal" data-target="#staticBackdrop" th:text="#{book.step}">
    Book new Step
</button>
</h1>
<table class="table table-hover">
    <thead>
    <tr>
        <th th:text="#{step.user.username}">Username</th>
        <th th:text="#{step.device.devicename}">Device Name</th> <th></th>
    </tr>
    </thead>
    <!-- IMPORTANT, class="list" have to be at tbody -->
    <tbody class="list">
    <tr th:each="step : ${allSteps}">
        <td class='username' th:value="${step.getUser().getUsername()}" th:text="${step.user.username}">Username</td>
        <td class="devicename" th:value="${step.getDevice().getDevicename()}"
            th:text="${step.device.devicename }" >Device name</td>
    </tr>
    <tr class='notfound'>
        <td colspan='4' th:text="#{step.norecord}">No record found</td>
    </tr>
    </tbody>
</table></table>

</div>
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">New Step</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/planning/{id} (id=${Step})}" th:object="${Step}" method="post">

            <div class="modal-body">
                <input th:type="hidden" th:field="*{id}"/>
                <select required class=" form-control" style="width: 40%"  id="sel">
                    <option value="none"  selected disabled hidden th:text="#{device.type}"> Device Type </option>
                    <option class="dropdown-item"  th:each="deviceType : ${allDeviceTypes}" th:value="${deviceType.getId()}" th:text="${deviceType.devicetypename}">Device Type</option>
                </select>
                <!--Dropdown-->
                <select required id="deviceNames" th:field="*{device}" class="form-control" style="visibility: hidden; width: 40%">
                    <option value="none" selected disabled hidden >Device Name</option>
                </select>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>